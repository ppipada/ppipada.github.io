var searchElem=document.getElementById("search-input");window.pankajpipadaCom=window.pankajpipadaCom||{},window.pankajpipadaCom.initialized||(window.pankajpipadaCom.lunrIndex=null,window.pankajpipadaCom.posts=null,window.pankajpipadaCom.initialized=!0,loadSearch());function loadSearch(){var e,n=(new Date).getTime(),t=localStorage.getItem("postData");if(t){if(t=JSON.parse(t),n<t.expiry){console.log("Using cached data"),buildIndex(t.data,checkURLAndSearch);return}console.log("Cached data expired"),localStorage.removeItem("postData")}e=new XMLHttpRequest,e.onreadystatechange=function(){if(e.readyState===4&&e.status===200)try{var t=JSON.parse(e.responseText);buildIndex(t,checkURLAndSearch),console.log("Search initialized"),localStorage.setItem("postData",JSON.stringify({data:t,expiry:(new Date).getTime()+7*24*60*60*1e3}))}catch(e){console.error("Error parsing JSON:",e),showError("Failed to load search data.")}else e.status!==200&&(console.error("Failed to load data:",e.status,e.statusText),showError("Failed to load search data."))},e.onerror=function(){console.error("Network error occurred."),showError("Failed to load search data due to network error.")},e.open("GET","../index.json"),e.send()}function buildIndex(e,t){window.pankajpipadaCom.posts=e,window.pankajpipadaCom.lunrIndex=lunr(function(){this.ref("url"),this.field("content",{boost:10}),this.field("title",{boost:20}),this.field("tags_str",{boost:15}),this.field("date"),window.pankajpipadaCom.posts.forEach(function(e){const t={...e,tags_str:e.tags.join(" ")};this.add(t)},this)}),console.log("Index built at",(new Date).toISOString()),t()}function showError(e){var t=document.getElementById("searchresults");t.innerHTML=`<br><h2 style="text-align:center">${e}</h2>`,searchElem.disabled=!0}function checkURLAndSearch(){var t=new URLSearchParams(window.location.search),e=t.get("query");e&&(searchElem.value=e,showSearchResults())}function showSearchResults(){if(!window.pankajpipadaCom.lunrIndex){console.log("Index not available.");return}var e,t,s=searchElem.value||"",n=s.trim().replace(/[^\w\s]/gi,"");if(!n){displayResults([]);return}e=window.pankajpipadaCom.lunrIndex.search(n),console.log("matches",e),t=e.map(e=>window.pankajpipadaCom.posts.find(t=>t.url===e.ref)),console.log("Match posts",t),displayResults(t)}function displayResults(e){const t=document.getElementById("searchresults");if(e.length){let n="";e.forEach(e=>{e&&(n+=getResultStr(e))}),t.innerHTML=n}else t.innerHTML="No results found."}function getResultStr(e){var t=`
      <li style="margin-bottom: 1rem">
        <a href="${e.url}">${e.title}</a><br />
        <p>${e.content.substring(0,150)}...</p>
        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; color: #6c757d; height: 1.2em; line-height: 1em; padding: 0.25em;">
            <div>${e.date}</div>
            <div><i class="fa fa-tags"></i>
                ${e.tags.map(e=>`<a href="/tags/${e}" style="color: #6c757d;">${e}</a>`).join(", ")}
            </div>
        </div>
      </li>`;return t}